<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freelancer Dashboard - CodeDesign Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="navbar-root"></div>

    <main>
        <div class="container" style="padding: 2rem 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                    <h1 id="userGreeting" style="margin-bottom: 0.5rem;">Freelancer Dashboard</h1>
                    <p id="userSubtitle" style="color: var(--text-secondary);"></p>
                </div>
                <div>
                    <a href="freelancer_profile.html" class="btn btn-secondary" id="viewProfileButton">Xem hồ sơ</a>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="background: white; padding: 1.5rem; border-radius: var(--radius-xl); box-shadow: var(--shadow-md);">
                    <h3 style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Dự án đang làm</h3>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="activeProjects">0</div>
                </div>
                <div style="background: white; padding: 1.5rem; border-radius: var(--radius-xl); box-shadow: var(--shadow-md);">
                    <h3 style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Số dư ví</h3>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--success-color);" id="walletBalance">0 ₫</div>
                    <button class="btn btn-primary btn-small" style="margin-top: 0.75rem; width: 100%;" id="withdrawBtn">
                        <i class="fas fa-money-bill-wave"></i> Rút tiền
                    </button>
                </div>
            </div>
            <div style="background: white; padding: 1.5rem; border-radius: var(--radius-xl); box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Thông tin hồ sơ</h2>
                <div id="freelancerMeta" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;"></div>
            </div>
            <div style="background: white; padding: 1.5rem; border-radius: var(--radius-xl); box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Bài viết nổi bật</h2>
                <div id="articlesList"></div>
                <button class="btn btn-primary" style="margin-top: 1rem;" id="createArticleButton">Đăng bài viết mới</button>
            </div>

            <section class="dashboard-card" id="paymentCard">
                <div class="dashboard-card-header">
                    <div>
                        <h2>Thanh toán & Giao dịch</h2>
                        <p class="text-muted">Quản lý số dư, lịch sử giao dịch và rút tiền.</p>
                    </div>
                    <button class="btn btn-secondary" id="refreshPaymentBtn">
                        <i class="fas fa-sync-alt"></i> Làm mới
                    </button>
                </div>
                <div id="paymentContent">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: var(--bg-gray); padding: 1rem; border-radius: var(--radius-lg);">
                            <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Số dư khả dụng</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-color);" id="availableBalance">0 ₫</div>
                        </div>
                        <div style="background: var(--bg-gray); padding: 1rem; border-radius: var(--radius-lg);">
                            <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Tổng thu nhập</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);" id="totalEarnings">0 ₫</div>
                        </div>
                        <div style="background: var(--bg-gray); padding: 1rem; border-radius: var(--radius-lg);">
                            <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">Đã rút</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-secondary);" id="totalWithdrawn">0 ₫</div>
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 1rem;">Lịch sử giao dịch</h3>
                        <div id="transactionHistory">
                            <div class="empty-state small">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Đang tải lịch sử giao dịch...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="dashboard-card" id="serviceManagerCard">
                <div class="dashboard-card-header">
                    <div>
                        <h2>Gói dịch vụ của tôi</h2>
                        <p class="text-muted">Quản lý các gói cố định mà bạn cung cấp cho khách hàng.</p>
                    </div>
                    <button class="btn btn-primary" id="createServiceBtn">
                        <i class="fas fa-plus"></i> Tạo gói mới
                    </button>
                </div>
                <div id="servicesEmptyState" class="empty-state" style="display: none;">
                    Bạn chưa có gói nào. Hãy tạo gói đầu tiên để hiển thị với khách hàng.
                </div>
                <div id="serviceList" class="service-list"></div>
            </section>

            <h2 style="margin-bottom: 1rem;">Available Projects</h2>
            <div id="projectsList">
                <!-- Projects will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <header class="modal-header">
                <div>
                    <h3>Rút tiền</h3>
                    <p class="text-muted">Rút tiền từ ví của bạn</p>
                </div>
                <button class="modal-close-btn" id="closeWithdrawModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </header>
            <form id="withdrawForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label>Số dư khả dụng</label>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-color);" id="modalAvailableBalance">0 ₫</div>
                    </div>
                    <div class="form-group">
                        <label for="withdrawAmount">Số tiền muốn rút (VND) *</label>
                        <input type="number" id="withdrawAmount" min="10000" step="10000" required placeholder="Nhập số tiền">
                        <small style="color: var(--text-secondary);">Số tiền tối thiểu: 10,000 ₫</small>
                    </div>
                    <div class="form-group">
                        <label for="withdrawMethod">Phương thức thanh toán *</label>
                        <select id="withdrawMethod" required>
                            <option value="">Chọn phương thức</option>
                            <option value="BANK_TRANSFER">Chuyển khoản ngân hàng</option>
                            <option value="PAYPAL">PayPal</option>
                            <option value="MOMO">MoMo</option>
                            <option value="ZALOPAY">ZaloPay</option>
                        </select>
                    </div>
                    <div class="form-group" id="bankAccountGroup" style="display: none;">
                        <label for="bankAccount">Số tài khoản ngân hàng *</label>
                        <input type="text" id="bankAccount" placeholder="Nhập số tài khoản">
                        <label for="bankName" style="margin-top: 0.75rem;">Tên ngân hàng *</label>
                        <input type="text" id="bankName" placeholder="Ví dụ: Vietcombank, Techcombank">
                        <label for="accountHolder" style="margin-top: 0.75rem;">Tên chủ tài khoản *</label>
                        <input type="text" id="accountHolder" placeholder="Tên người nhận">
                    </div>
                    <div class="form-group" id="paypalGroup" style="display: none;">
                        <label for="paypalEmail">Email PayPal *</label>
                        <input type="email" id="paypalEmail" placeholder="your.email@example.com">
                    </div>
                    <div class="form-group" id="momoGroup" style="display: none;">
                        <label for="momoPhone">Số điện thoại MoMo *</label>
                        <input type="tel" id="momoPhone" placeholder="0123456789">
                    </div>
                    <div class="form-group" id="zalopayGroup" style="display: none;">
                        <label for="zalopayPhone">Số điện thoại ZaloPay *</label>
                        <input type="tel" id="zalopayPhone" placeholder="0123456789">
                    </div>
                    <div id="withdrawError" class="error-message" style="display: none;"></div>
                </div>
                <footer class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelWithdrawBtn">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-money-bill-wave"></i> Xác nhận rút tiền
                    </button>
                </footer>
            </form>
        </div>
    </div>

    <div id="serviceModal" class="modal-overlay" style="display: none;">
        <div class="modal-content service-modal">
            <header class="modal-header">
                <div>
                    <h3 id="serviceModalTitle">Tạo gói dịch vụ</h3>
                    <p class="text-muted" id="serviceModalSubtitle">Điền thông tin chi tiết cho gói của bạn</p>
                </div>
                <button class="modal-close-btn" id="closeServiceModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </header>
            <div class="service-steps">
                <button class="service-step-btn active" data-step="1">1. Thông tin</button>
                <button class="service-step-btn" data-step="2">2. Giá & thời gian</button>
                <button class="service-step-btn" data-step="3">3. Media</button>
            </div>
            <div class="service-step-content">
                <div class="service-step-panel active" data-step-panel="1">
                    <label>Tiêu đề gói*</label>
                    <input type="text" id="serviceNameInput" placeholder="Ví dụ: Thiết kế landing page chuẩn SEO">
                    <label>Danh mục</label>
                    <input type="text" id="serviceCategoryInput" placeholder="Ví dụ: UI/UX, Branding">
                    <label>Mô tả chi tiết*</label>
                    <textarea id="serviceDescriptionInput" rows="5" placeholder="Mô tả nội dung gói, phạm vi công việc..."></textarea>
                </div>
                <div class="service-step-panel" data-step-panel="2">
                    <label>Giá cố định (VND)*</label>
                    <input type="number" id="servicePriceInput" min="0" step="10000">
                    <div class="service-grid">
                        <div>
                            <label>Thời gian giao hàng (ngày)*</label>
                            <input type="number" id="serviceDeliveryInput" min="1" max="60">
                        </div>
                        <div>
                            <label>Số lần chỉnh sửa</label>
                            <input type="number" id="serviceRevisionsInput" min="1" value="1">
                        </div>
                    </div>
                    <label>Danh sách deliverables*</label>
                    <textarea id="serviceDeliverablesInput" rows="4" placeholder="Mỗi dòng là một deliverable"></textarea>
                    <label>Thông tin yêu cầu từ khách hàng</label>
                    <textarea id="serviceRequirementsInput" rows="4" placeholder="Mỗi dòng là một yêu cầu thông tin"></textarea>
                </div>
                <div class="service-step-panel" data-step-panel="3">
                    <label>Ảnh bìa</label>
                    <div class="media-upload">
                        <input type="file" id="serviceCoverInput" accept="image/*">
                        <small>Tải ảnh cover nổi bật (PNG/JPG)</small>
                        <div id="serviceCoverPreview" class="service-cover-preview"></div>
                    </div>
                    <label>Gallery (ảnh/video minh họa)</label>
                    <div class="media-upload">
                        <input type="file" id="serviceGalleryInput" accept="image/*,video/*" multiple>
                        <small>Bạn có thể tải lên tối đa 5 file</small>
                        <div id="serviceGalleryPreview" class="service-gallery-preview"></div>
                    </div>
                </div>
            </div>
            <footer class="modal-actions">
                <button class="btn btn-secondary" id="servicePrevStepBtn">
                    <i class="fas fa-arrow-left"></i> Quay lại
                </button>
                <button class="btn btn-secondary" id="serviceNextStepBtn">
                    Tiếp tục <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-primary" id="saveServiceDraftBtn">
                    <i class="fas fa-save"></i> Lưu bản nháp
                </button>
            </footer>
            <div class="modal-footer-inline">
                <button class="btn btn-success" id="submitServiceForReviewBtn">
                    <i class="fas fa-paper-plane"></i> Gửi duyệt
                </button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>

